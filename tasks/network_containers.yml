---

- name: create promtail volume
  docker_volume:
    name: promtail_data

- name: promtail container
  docker_container:
    name: promtail
    image: grafana/promtail:2.9.1
    volumes:
      - "promtail_data:/etc/promtail"
      - "/var/log:/var/log"
    restart_policy: unless-stopped

- name: node_exporter container
  docker_container:
    name: node_exporter
    image: prom/node-exporter@sha256:40ba9ef2dc8d7564d76656feca7f679062d2df71653618211d38c0ec51ebc28c
    command: ["--path.rootfs=/host"]
    ports:
      - "9100:9100"
    volumes:
      - "/:/host:ro,rslave"
    restart_policy: unless-stopped

# duckdns
# - name: duckdns
#   docker_container:
#     name: duckdns
#     image: linuxserver/duckdns@sha256:15437356505cf8a7bf4633a4899d8e9b6c5a4b42604f0ca2f0e9948f0ffa0111
#     volumes:
#       - "/home/anthony/docker-volumes/duckdns/config:/config"
#     env:
#       PUID: "1000"
#       PGID: "1000"
#       TZ: "{{ timezone }}"
#       SUBDOMAINS: ""
#       TOKEN: ""
#     restart_policy: unless-stopped

# wireguard
- name: wireguard
  docker_container:
    name: wireguard
    image: linuxserver/wireguard@sha256:fb193da418ee846d2f7436d8818f8e849936e14de82bb0fc110ace289af39aff
    ports:
      - "51820:51820/udp"
    volumes:
      - "/home/anthony/docker-volumes/wireguard/config:/config"
      - "/lib/modules:/lib/modules"
    env:
      PUID: "1000"
      PGID: "1000"
      SERVERURL: "mole-homelab.duckdns.org"
      PEERS: "desktop,laptop,phone,tablet"
      INTERNAL_SUBNET: 10.13.13.0/24
      TZ: "{{ timezone }}"
    capabilities:
      - net_admin
      - sys_module
    sysctls:
      net.ipv4.conf.all.src_valid_mark: 1
    restart_policy: unless-stopped

# tautulli
- name: tautulli
  docker_container:
    name: tautulli
    image: tautulli/tautulli@sha256:fd0b9332fc96cd4e536c026ba0e2e9e76af44baa0755f82621f4972b57e8db1e
    ports:
      - "8181:8181"
    volumes:
      - "/home/anthony/docker-volumes/tautulli/config:/config"
      - "/home/anthony/docker-volumes/tautulli/logs:/logs"
    env:
      PUID: "1000"
      PGID: "1000"
    restart_policy: unless-stopped

# mosquitto
- name: mosquitto
  docker_container:
    name: mosquitto
    image: eclipse-mosquitto@sha256:5b9408e7df29ee3b41e4e5c406b3f0b08bdacaea75db36a6e68d6a3cbebf7ea2
    ports:
      - "1883:1883"
    volumes:
      - "/home/anthony/docker-volumes/mosquitto/data:/data"
      - "/home/anthony/docker-volumes/mosquitto/config:/config"
      - "/home/anthony/docker-volumes/mosquitto/logs:/logs"
    env:
      PUID: "1000"
      PGID: "1000"
    restart_policy: unless-stopped

# home assistant
#- name: home-assistant
#  docker_container:
#    name: home-assistant
#    image:
#    ports:
#    volumes:
#    restart_policy: unless-stopped